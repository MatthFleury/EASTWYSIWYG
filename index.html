<!DOCTYPE html>
<html>
<head><!-- CDN hosted by Cachefly -->
<link href="css/style.css" rel="stylesheet" type="text/css"/>
<script src="tinymce/js/tinymce/tinymce.min.js"></script>
<script src="FileSaver/FileSaver.js"></script>
<script src="jquery-2.1.0.min.js"></script>
<script>
        tinymce.init({selector:'textarea'});
</script>
<script>
	var xmlComplet = "";
	
	function convert(){

		var child = $("#mce_0_ifr").contents().find("body").html();

		var xmlHead = "<?xml version=\"1.0\" encoding=\"utf-8\"?><?xml-stylesheet type=\"text/xsl\" href=\"EAST.xsl\"?><EAST transition=\"burst\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  xsi:noNamespaceSchemaLocation=\"EAST.xsd\">\n";

		var xmlTitlePage = "<PAGE_TITRE><TITRE>"+$("#title").val()+"</TITRE><SOUS_TITRE>"+$("#subTitle").val()+"</SOUS_TITRE><AUTEUR>"+$("#author").val()+"</AUTEUR><EMAIL>"+$("#authormail").val()+"</EMAIL><IDENTIFIANT>"+$("#idpres").val()+"</IDENTIFIANT><DATE_EXPOSE>"+$("#dateexpo").val()+"</DATE_EXPOSE></PAGE_TITRE>";
		var xmlDebut = "<PARTIE>\n<SECTION>\n";

		var xmlPreferences = "<PREFERENCES><PUCE colorpuce=\"orange\" level=\"1\" type=\"square\"/><PUCE colorpuce=\"green\" level=\"2\" type=\"disc\"/><PUCE colorpuce=\"orange\" level=\"3\" type=\"circle\"/>";
		if($("#comments").val())
			xmlPreferences += "<COMMENTAIRES display=\""+$("#comments").val()+"\"></COMMENTAIRES>"
		if($("#print").val())
			xmlPreferences += "<IMPRESSION display=\""+$("#print").val()+"\"></IMPRESSION>"
		if($("#buttonbarre").val())
			xmlPreferences += "<BARRE_BOUTONS display=\""+$("#buttonbarre").val()+"\"></BARRE_BOUTONS>"
		xmlPreferences += "<PAGE/></PREFERENCES>\n"

		var xmlLogoG = ""
		var xmlLogoD = ""
		if($("#leftlogo").val())
			xmlLogoG = "<LOGO_GAUCHE fichier="+$("#leftlogo").val()+" hauteur_SVG=\"30\" largeur_SVG=\"30\"/>\n"
		if($("#rightlogo").val())
			xmlLogoD = "<LOGO_DROIT fichier="+$("#rightlogo").val()+" hauteur_SVG=\"30\" largeur_SVG=\"30\"/>\n"
		var xmlPiedPage = "<PIEDPAGE_GAUCHE>"+$("#leftfooter").val()+"</PIEDPAGE_GAUCHE><PIEDPAGE_DROIT>"+$("#rightfooter").val()+"</PIEDPAGE_DROIT>\n"
		var xmlFin = "</SECTION>\n</PARTIE>\n</EAST>";
		
		child = child.replace(/<p/g,"<PARAGRAPHE");
		child = child.replace(/<\/p>/g,"</PARAGRAPHE>\n");
		
		child = child.replace(/<h1>/g,"<TITRE>");
		child = child.replace(/<\/h1>/g,"</TITRE>\n");
		
		child = child.replace(/<ul>/g,"<LISTE>");
		child = child.replace(/<\/ul>/g,"</LISTE>\n");
		
		child = child.replace(/<li>/g,"<EL>");
		child = child.replace(/<\/li>/g,"</EL>");
		child = child.replace(/<br data-mce-bogus="1">/g,"");
		
		// gestion balises img et meta-données image
		child = child.replace(/<img/g,"<IMAGE");
		child = child.replace(/src/g,"fichier");
		child = child.replace(/width/g,"largeur");
		child = child.replace(/height/g,"hauteur");
		
		// gestion sous-titres
		child = child.replace(/<h2>/g,"<SOUS_TITRE>");
		child = child.replace(/<\/h2>/g,"</SOUS_TITRE>\n");
		
		xmlComplet = xmlHead+xmlPreferences+xmlLogoG+xmlLogoD+xmlPiedPage+xmlTitlePage+xmlDebut+child+xmlFin;
		var xmlHtml =  xmlComplet.replace(/</g,"&lt;");
		xmlHtml = xmlHtml.replace(/>/g,"&gt;");

		document.all["xmlContent"].innerHTML = xmlHtml;
		
		document.getElementById("titre_XML").style.visibility="visible";
	}
	
	function save(){
		convert();
		var blob = new Blob([xmlComplet], {type: "text/plain;charset=utf-8"});
		saveAs(blob, "File.xml");
	}
</script>
</head>
<body id="base">
	<section id="wrapper">
		<header>
			<h1>EASTWYSIWYG</h1>
		</header>
		<article id="pref">
			<h2>Préférences simples</h2>
			<label for="leftfooter">Pied de page gauche : </label><input type="text" id="leftfooter" value="Module Multimédia"></br>
			<label for="rightfooter">Pied de page droit : </label><input type="text" id="rightfooter" value="M2 MIAGE APP"></br>
			<label for="leftlogo">Logo gauche : </label><input type="file" id="leftlogo"></br>
			<label for="rightlogo">Logo droit : </label><input type="file" id="rightlogo">
		</article>
		<article id="pref2">
			<h2>Préférences avancées</h2>
			<label for="comments">Commentaires ? : </label><select id="comments"><option></option><option value="oui">Oui</option><option value="non">Non</option></select></br>
			<label for="print">Impression ? : </label><select id="print"><option></option><option value="oui">Oui</option><option value="non">Non</option></select></br>
			<label for="buttonbarre">Barre de bouton ? : </label><select id="buttonbarre"><option></option><option value="oui">Oui</option><option value="non">Non</option></select></br>
		</article>
		<article id="titlePage">
			<h2>Page titre</h2>
			<label for="title">Titre : </label><input type="text" id="title" value="Titre"></br>
			<label for="subTitle">Sous tire : </label><input type="text" id="subTitle" value="Sous Titre"></br>
			<label for="author">Auteur : </label><input type="text" id="author" value="Auteur"></br>
			<label for="authormail">E-mail : </label><input type="mail" id="authormail" value="mail@mail.com"></br>
			<label for="idpres">Identifiant : </label><input type="text" id="idpres" value="Identifiant"></br>
			<label for="dateexpo">Date de l'exposé : </label><input type="text" id="dateexpo" value="01/01/2000"></br>
		</article>
		<article id="wys">
			<h2>Entrez les données que vous souhaitez convertir en XML</h2>
			<textarea>Entrez vos données ici.</textarea>
			<br/>
			<button onClick="convert()">Prévisualisez le XML</button><button onClick="save()">Sauvegarder en .xml</button>
		</article>
		<article id="wyg">
			<h2 id="titre_XML" style="visibility:hidden;">Résultat en XML</h2>
			<pre id="xmlContent"></pre>
		</article>
	</section>
	<footer>
	</footer>
</body>
</html>